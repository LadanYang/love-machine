<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>词汇判断实验</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 100px; }
    #stimulus { font-size: 48px; }
    #instructions { max-width: 600px; margin: auto; font-size: 20px; }
  </style>
</head>
<body>
  <div id="instructions">
    <h2>实验说明</h2>
    <p>接下来你会看到一些汉字词语。</p>
    <p>你的任务是判断这些词语是否是真实的成语。</p>
    <p>如果是真成语，请按 <b>空格键</b>；如果不是，请按任意其他键。</p>
    <p>请尽量快速、准确地完成任务。</p>
    <button onclick="startExperiment()">开始实验</button>
  </div>

  <div id="stimulus" style="display:none;"></div>

  <script>
    let names = [];
    let trials = [];
    let trialIndex = 0;
    let results = [];

    // 一些成语 & 伪词
    const idioms = ["画蛇添足","杯弓蛇影","刻舟求剑","守株待兔","掩耳盗铃","亡羊补牢"];
    const nonwords = ["马水天风","红白树草","人石木火","飞山雨地","手目口心","鱼书竹狗"];

    function startExperiment() {
      document.getElementById("instructions").innerHTML = `
        <p>请输入两个名字（熟悉但不同的人）：</p>
        <input id="name1" placeholder="名字1"><br><br>
        <input id="name2" placeholder="名字2"><br><br>
        <button onclick="beginTask()">确认</button>
      `;
    }

    function beginTask() {
      const n1 = document.getElementById("name1").value.trim();
      const n2 = document.getElementById("name2").value.trim();
      if (!n1 || !n2) { alert("请输入两个名字"); return; }
      names = [n1, n2];

      // 生成 trials
      const stimuli = idioms.map(w=>({word:w, correct:true}))
        .concat(nonwords.map(w=>({word:w, correct:false})));
      // 每个 prime 名字都配上所有词
      names.forEach(name=>{
        stimuli.forEach(s=>{
          trials.push({...s, prime:name});
        });
      });
      // 打乱
      trials = trials.sort(()=>Math.random()-0.5);

      document.getElementById("instructions").style.display = "none";
      document.getElementById("stimulus").style.display = "block";
      runTrial();
    }

    function runTrial() {
      if (trialIndex >= trials.length) { endExperiment(); return; }
      const stimDiv = document.getElementById("stimulus");
      const trial = trials[trialIndex];

      // fixation
      stimDiv.innerText = "+";
      setTimeout(()=>{
        // prime
        stimDiv.innerText = trial.prime;
        setTimeout(()=>{
          // mask
          stimDiv.innerText = "#####";
          setTimeout(()=>{
            // target word
            stimDiv.innerText = trial.word;
            const start = performance.now();

            function handleResponse(e) {
              const rt = performance.now() - start;
              const correct = (trial.correct && e.code==="Space") || (!trial.correct && e.code!=="Space");
              results.push({prime:trial.prime, word:trial.word, rt:rt, correct:correct});
              document.removeEventListener("keydown", handleResponse);
              trialIndex++;
              runTrial();
            }
            document.addEventListener("keydown", handleResponse);
          }, 50);
        }, 30);
      }, 500);
    }

    function endExperiment() {
      const stimDiv = document.getElementById("stimulus");
      stimDiv.style.display = "none";

      // 计算结果
      let summary = {};
      names.forEach(n=>{
        const data = results.filter(r=>r.prime===n);
        const acc = data.filter(r=>r.correct).length / data.length;
        const rt = data.filter(r=>r.correct).reduce((a,b)=>a+b.rt,0)/data.filter(r=>r.correct).length;
        summary[n] = {acc:acc, rt:rt};
      });

      let chosen = names[0];
      if (summary[names[1]].acc > summary[names[0]].acc && summary[names[1]].rt < summary[names[0]].rt) {
        chosen = names[1];
      }

      document.body.innerHTML = `
        <h2>实验完成</h2>
        <p>${names[0]}: 准确率 ${(summary[names[0]].acc*100).toFixed(1)}%，反应时 ${summary[names[0]].rt.toFixed(1)} ms</p>
        <p>${names[1]}: 准确率 ${(summary[names[1]].acc*100).toFixed(1)}%，反应时 ${summary[names[1]].rt.toFixed(1)} ms</p>
        <h3>更重要的人可能是：${chosen}</h3>
      `;
      console.log("所有结果：", results);
    }
  </script>
</body>
</html>

