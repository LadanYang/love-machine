<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>词汇判断实验</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    #stimulus { font-size: 48px; margin: 40px; }
    #buttons { margin-top: 20px; display: none; }
    button { font-size: 22px; padding: 15px 25px; margin: 10px; border-radius: 10px; }
    #instructions { max-width: 600px; margin: auto; font-size: 20px; }
  </style>
</head>
<body>
  <div id="instructions">
    <h2>实验说明</h2>
    <p>你会看到一些汉字词语。</p>
    <p>你的任务是判断这些词语是否是真实的成语。</p>
    <p>如果是真成语，请点 <b>“是真成语 ✅”</b>；如果不是，请点 <b>“不是成语 ❌”</b>。</p>
    <p>请尽量快速、准确地完成任务。</p>
    <button onclick="startExperiment()">开始实验</button>
  </div>

  <div id="stimulus" style="display:none;"></div>
  <div id="buttons">
    <button onclick="handleResponse(true)">是真成语 ✅</button>
    <button onclick="handleResponse(false)">不是成语 ❌</button>
  </div>

  <script>
    let names = [];
    let trials = [];
    let trialIndex = 0;
    let results = [];
    let trialStart = 0;

    // 成语池（50条）
    const idioms = [
      "画蛇添足","杯弓蛇影","刻舟求剑","守株待兔","掩耳盗铃","亡羊补牢","指鹿为马","叶公好龙","东施效颦","盲人摸象",
      "纸上谈兵","狐假虎威","自相矛盾","滥竽充数","愚公移山","愁眉苦脸","庖丁解牛","囫囵吞枣","鹤立鸡群","井底之蛙",
      "守口如瓶","如鱼得水","一箭双雕","画龙点睛","水落石出","望梅止渴","口是心非","杯水车薪","开天辟地","心猿意马",
      "一石二鸟","风马牛不相及","破釜沉舟","按图索骥","惊弓之鸟","狼狈为奸","鸡犬不宁","骑虎难下","一帆风顺","无中生有",
      "心花怒放","天马行空","滔滔不绝","大公无私","迫不及待","前车之鉴","百发百中","一丝不苟","一见钟情","自作自受"
    ];
    // 伪词池（50条，随机造）
    const nonwords = [
      "风马书草","云石鱼灯","虎人心木","竹火天山","雨狗书人","地风花牛","水山口火","鸟树心马","日竹鱼石","人月木心",
      "草火雨山","星手月心","风鱼犬牛","树水人心","马竹书云","石鸟木风","火草鱼人","天竹山书","花月人鱼","心火犬树",
      "书鱼天草","木风牛星","竹雨人鸟","水石犬心","山马树火","云鱼花人","月心竹天","牛火草水","鸟木星山","人风鱼竹",
      "雨月犬心","书天石火","竹牛花马","鱼风鸟水","草木山心","星人月火","犬竹水鸟","天书花风","石鱼草火","马树月水",
      "云人竹心","火牛天鱼","风水木书","鸟草人月","山竹火星","心树水风","花鱼人竹","木犬山月","竹火风鸟","水心草石"
    ];

    function startExperiment() {
      document.getElementById("instructions").innerHTML = `
        <p>请输入两个名字（熟悉但不同的人）：</p>
        <input id="name1" placeholder="名字1"><br><br>
        <input id="name2" placeholder="名字2"><br><br>
        <button onclick="beginTask()">确认</button>
      `;
    }

    function beginTask() {
      const n1 = document.getElementById("name1").value.trim();
      const n2 = document.getElementById("name2").value.trim();
      if (!n1 || !n2) { alert("请输入两个名字"); return; }
      names = [n1, n2];

      // 生成 trials
      const stimuli = idioms.map(w=>({word:w, correct:true}))
        .concat(nonwords.map(w=>({word:w, correct:false})));
      names.forEach(name=>{
        stimuli.forEach(s=>{
          trials.push({...s, prime:name});
        });
      });
      trials = trials.sort(()=>Math.random()-0.5);

      document.getElementById("instructions").style.display = "none";
      document.getElementById("stimulus").style.display = "block";
      runTrial();
    }

    function runTrial() {
      if (trialIndex >= trials.length) { endExperiment(); return; }
      const stimDiv = document.getElementById("stimulus");
      const trial = trials[trialIndex];

      document.getElementById("buttons").style.display = "none";

      // fixation
      stimDiv.innerText = "+";
      setTimeout(()=>{
        // prime
        stimDiv.innerText = trial.prime;
        setTimeout(()=>{
          // mask
          stimDiv.innerText = "#####";
          setTimeout(()=>{
            // target
            stimDiv.innerText = trial.word;
            trialStart = performance.now();
            document.getElementById("buttons").style.display = "block";
          }, 50);
        }, 30);
      }, 500);
    }

    function handleResponse(isIdiom) {
      const trial = trials[trialIndex];
      const rt = performance.now() - trialStart;
      const correct = (trial.correct && isIdiom) || (!trial.correct && !isIdiom);
      results.push({prime:trial.prime, word:trial.word, rt:rt, correct:correct});
      trialIndex++;
      runTrial();
    }

    function endExperiment() {
      const stimDiv = document.getElementById("stimulus");
      stimDiv.style.display = "none";
      document.getElementById("buttons").style.display = "none";

      // 计算结果
      let summary = {};
      names.forEach(n=>{
        const data = results.filter(r=>r.prime===n);
        const acc = data.filter(r=>r.correct).length / data.length;
        const rt = data.filter(r=>r.correct).reduce((a,b)=>a+b.rt,0)/data.filter(r=>r.correct).length;
        summary[n] = {acc:acc, rt:rt};
      });

      let chosen = names[0];
      if (summary[names[1]].acc > summary[names[0]].acc && summary[names[1]].rt < summary[names[0]].rt) {
        chosen = names[1];
      }

      document.body.innerHTML = `
        <h2>实验完成</h2>
        <p>${names[0]}: 准确率 ${(summary[names[0]].acc*100).toFixed(1)}%，反应时 ${summary[names[0]].rt.toFixed(1)} ms</p>
        <p>${names[1]}: 准确率 ${(summary[names[1]].acc*100).toFixed(1)}%，反应时 ${summary[names[1]].rt.toFixed(1)} ms</p>
        <h3>更重要的人可能是：${chosen}</h3>
      `;
      console.log("所有结果：", results);
    }
  </script>
</body>
</html>

